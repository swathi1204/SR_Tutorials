{"ast":null,"code":"export const memoize = (provider, isExpired, requiresRefresh) => {\n  let resolved;\n  let pending;\n  let hasResult;\n  let isConstant = false;\n  const coalesceProvider = async () => {\n    if (!pending) {\n      pending = provider();\n    }\n    try {\n      resolved = await pending;\n      hasResult = true;\n      isConstant = false;\n    } finally {\n      pending = undefined;\n    }\n    return resolved;\n  };\n  if (isExpired === undefined) {\n    return async options => {\n      if (!hasResult || options?.forceRefresh) {\n        resolved = await coalesceProvider();\n      }\n      return resolved;\n    };\n  }\n  return async options => {\n    if (!hasResult || options?.forceRefresh) {\n      resolved = await coalesceProvider();\n    }\n    if (isConstant) {\n      return resolved;\n    }\n    if (requiresRefresh && !requiresRefresh(resolved)) {\n      isConstant = true;\n      return resolved;\n    }\n    if (isExpired(resolved)) {\n      await coalesceProvider();\n      return resolved;\n    }\n    return resolved;\n  };\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}